/* mobileSidebarFix.css - 完整的移动端侧边栏修复样式 */

/* 重置可能的冲突样式 */
@media (max-width: 992px) {
  /* 确保侧边栏默认隐藏 */
  .sidebar {
    position: fixed !important;
    top: 70px !important;
    left: 0 !important;
    width: var(--sidebar-width, 250px) !important;
    height: calc(100vh - 70px) !important;
    transform: translateX(-100%) !important;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    z-index: 900 !important;
    will-change: transform;
  }
  
  /* 侧边栏显示状态 */
  .sidebar.show {
    transform: translateX(0) !important;
  }
  
  /* 遮罩层默认状态 */
  .sidebar-overlay {
    display: none !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: rgba(0, 0, 0, 0.5) !important;
    z-index: 899 !important;
    opacity: 0;
    transition: opacity 0.3s ease !important;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* 遮罩层显示状态 */
  .sidebar-overlay.show {
    display: block !important;
    opacity: 1 !important;
  }
  
  /* 主体内容锁定滚动 */
  body.mobile-sidebar-open {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
    height: 100vh !important;
  }
  
  /* 汉堡菜单样式 */
  .mobile-toggle {
    display: flex !important;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    padding: 0;
    background: none;
    border: none;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    z-index: 1001;
  }
  
  /* 汉堡菜单图标容器 */
  .mobile-toggle .hamburger {
    width: 24px;
    height: 20px;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  
  /* 汉堡菜单线条 */
  .mobile-toggle .hamburger span {
    display: block;
    position: absolute;
    height: 2.5px;
    width: 100%;
    background: var(--primary-color, #1e293b);
    border-radius: 2px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    left: 0;
  }
  
  .mobile-toggle .hamburger span:nth-child(1) {
    top: 0;
  }
  
  .mobile-toggle .hamburger span:nth-child(2) {
    top: 50%;
    transform: translateY(-50%);
  }
  
  .mobile-toggle .hamburger span:nth-child(3) {
    bottom: 0;
  }
  
  /* 汉堡菜单激活状态（变成X） */
  .mobile-toggle.active .hamburger span:nth-child(1) {
    transform: rotate(45deg);
    top: 50%;
    margin-top: -1.25px;
  }
  
  .mobile-toggle.active .hamburger span:nth-child(2) {
    opacity: 0;
    transform: translateX(20px);
  }
  
  .mobile-toggle.active .hamburger span:nth-child(3) {
    transform: rotate(-45deg);
    bottom: 50%;
    margin-bottom: -1.25px;
  }
  
  /* 隐藏PC端折叠按钮 */
  .sidebar-toggle {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }
  
  /* 主内容区域调整 */
  .main-content {
    margin-left: 0 !important;
    padding: 15px !important;
  }
  
  /* 侧边栏滚动优化 */
  .sidebar {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  
  /* 防止点击穿透 */
  .sidebar.show {
    pointer-events: auto !important;
  }
  
  .sidebar:not(.show) {
    pointer-events: none !important;
  }
}

/* PC端样式 */
@media (min-width: 993px) {
  /* 隐藏移动端控件 */
  .mobile-toggle {
    display: none !important;
    visibility: hidden !important;
  }
  
  .sidebar-overlay {
    display: none !important;
  }
  
  /* 确保侧边栏正常显示 */
  .sidebar {
    transform: translateX(0) !important;
  }
  
  /* 确保主体可以滚动 */
  body {
    position: static !important;
    overflow: visible !important;
  }
}

/* iOS特定修复 */
@supports (-webkit-touch-callout: none) {
  @media (max-width: 992px) {
    .sidebar {
      -webkit-transform: translateX(-100%);
    }
    
    .sidebar.show {
      -webkit-transform: translateX(0);
    }
    
    body.mobile-sidebar-open {
      position: fixed !important;
      width: 100% !important;
    }
  }
}

/* 防止动画期间的闪烁 */
.sidebar,
.sidebar-overlay,
.mobile-toggle .hamburger span {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-perspective: 1000;
  perspective: 1000;
}

/* 触摸优化 */
@media (hover: none) and (pointer: coarse) {
  .mobile-toggle {
    min-width: 44px;
    min-height: 44px;
  }
  
  .sidebar-nav a {
    min-height: 44px;
    padding: 12px 16px;
  }
}

/* 安全区域适配（iPhone X及以上） */
@supports (padding: max(0px)) {
  @media (max-width: 992px) {
    .sidebar {
      padding-left: max(12px, env(safe-area-inset-left));
      padding-right: max(12px, env(safe-area-inset-right));
      padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
    
    .top-navbar {
      padding-left: max(20px, env(safe-area-inset-left));
      padding-right: max(20px, env(safe-area-inset-right));
    }
  }
}

/* 确保优先级最高 */
@media (max-width: 992px) {
  .sidebar-toggle {
    display: none !important;
    visibility: hidden !important;
    width: 0 !important;
    height: 0 !important;
    opacity: 0 !important;
    position: absolute !important;
    overflow: hidden !important;
    pointer-events: none !important;
  }
}
